<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/kundaliai/roomRepository/AstrologyReadingDao.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/kundaliai/roomRepository/AstrologyReadingDao.kt" />
              <option name="originalContent" value="package com.example.kundaliai.roomRepository&#10;&#10;&#10;import androidx.room.Dao&#10;import androidx.room.Insert&#10;import androidx.room.OnConflictStrategy&#10;import androidx.room.Query&#10;&#10;@Dao&#10;interface AstrologyReadingDao {&#10;    // Replace existing row when username (or primary key) conflicts to prevent duplicates&#10;    @Insert(onConflict = OnConflictStrategy.REPLACE)&#10;    suspend fun insertReading(reading: AstrologyReading)&#10;&#10;    @Query(&quot;SELECT * FROM astrology_readings WHERE username = :username&quot;)&#10;    suspend fun getReadingsByUsername(username: String): List&lt;AstrologyReading&gt;&#10;&#10;    @Query(&quot;SELECT * FROM astrology_readings ORDER BY timestamp DESC&quot;)&#10;    suspend fun getAllReadings(): List&lt;AstrologyReading&gt;&#10;}&#10;" />
              <option name="updatedContent" value="package com.example.kundaliai.roomRepository&#10;&#10;&#10;import androidx.room.Dao&#10;import androidx.room.Insert&#10;import androidx.room.OnConflictStrategy&#10;import androidx.room.Query&#10;&#10;@Dao&#10;interface AstrologyReadingDao {&#10;    // Replace existing row when username (or primary key) conflicts to prevent duplicates&#10;    @Insert(onConflict = OnConflictStrategy.REPLACE)&#10;    suspend fun insertReading(reading: AstrologyReading)&#10;&#10;    @Query(&quot;SELECT * FROM astrology_readings WHERE username = :username&quot;)&#10;    suspend fun getReadingsByUsername(username: String): List&lt;AstrologyReading&gt;&#10;&#10;    @Query(&quot;SELECT * FROM astrology_readings ORDER BY timestamp DESC&quot;)&#10;    suspend fun getAllReadings(): List&lt;AstrologyReading&gt;&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/kundaliai/ui/viewmodels/LiveSessionViewModel.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/kundaliai/ui/viewmodels/LiveSessionViewModel.kt" />
              <option name="originalContent" value="package com.example.kundaliai.ui.viewmodels&#10;&#10;import android.app.Application&#10;import android.content.Context&#10;import androidx.lifecycle.AndroidViewModel&#10;import androidx.lifecycle.viewModelScope&#10;import com.example.kundaliai.LiveSessionManager&#10;import com.example.kundaliai.roomRepository.AstrologyDatabase&#10;import kotlinx.coroutines.flow.MutableStateFlow&#10;import kotlinx.coroutines.flow.StateFlow&#10;import kotlinx.coroutines.flow.asStateFlow&#10;import kotlinx.coroutines.launch&#10;&#10;class LiveSessionViewModel(application: Application) : AndroidViewModel(application) {&#10;&#10;    private val database = AstrologyDatabase.getDatabase(application)&#10;    private val dao = database.astrologyReadingDao()&#10;&#10;    private val _astrologyJsonData = MutableStateFlow&lt;String?&gt;(null)&#10;    val astrologyJsonData: StateFlow&lt;String?&gt; = _astrologyJsonData.asStateFlow()&#10;&#10;    private val _isLoading = MutableStateFlow(false)&#10;    val isLoading: StateFlow&lt;Boolean&gt; = _isLoading.asStateFlow()&#10;    &#10;    private val _isReady = MutableStateFlow(false)&#10;    val isReady: StateFlow&lt;Boolean&gt; = _isReady.asStateFlow()&#10;    &#10;    private var liveSessionManager: LiveSessionManager? = null&#10;&#10;    fun loadAstrologyData(username: String, context: Context) {&#10;        viewModelScope.launch {&#10;            _isLoading.value = true&#10;            try {&#10;                // Fetch the latest reading for this person&#10;                val readings = dao.getReadingsByUsername(username)&#10;                val jsonData = readings.firstOrNull()?.jsonData&#10;                &#10;                if (jsonData != null) {&#10;                    _astrologyJsonData.value = jsonData&#10;                    &#10;                    // Initialize LiveSessionManager with the JSON data&#10;                    liveSessionManager = LiveSessionManager(context, jsonData)&#10;                    &#10;                    _isReady.value = true&#10;                    println(&quot;Loaded astrology data for: $username&quot;)&#10;                } else {&#10;                    println(&quot;No data found for: $username&quot;)&#10;                }&#10;            } catch (e: Exception) {&#10;                println(&quot;Error loading astrology data: ${e.message}&quot;)&#10;            } finally {&#10;                _isLoading.value = false&#10;            }&#10;        }&#10;    }&#10;    &#10;    fun startListening() {&#10;        viewModelScope.launch {&#10;            liveSessionManager?.startListening(viewModelScope)&#10;        }&#10;    }&#10;    &#10;    fun stopListening() {&#10;        viewModelScope.launch {&#10;            liveSessionManager?.stopListening()&#10;        }&#10;    }&#10;    &#10;    override fun onCleared() {&#10;        super.onCleared()&#10;        viewModelScope.launch {&#10;            liveSessionManager?.stopListening()&#10;        }&#10;    }&#10;}" />
              <option name="updatedContent" value="package com.example.kundaliai.ui.viewmodels&#10;&#10;import android.app.Application&#10;import android.content.Context&#10;import androidx.lifecycle.AndroidViewModel&#10;import androidx.lifecycle.viewModelScope&#10;import com.example.kundaliai.LiveSessionManager&#10;import com.example.kundaliai.roomRepository.AstrologyDatabase&#10;import kotlinx.coroutines.flow.MutableStateFlow&#10;import kotlinx.coroutines.flow.StateFlow&#10;import kotlinx.coroutines.flow.asStateFlow&#10;import kotlinx.coroutines.launch&#10;&#10;class LiveSessionViewModel(application: Application) : AndroidViewModel(application) {&#10;&#10;    private val database = AstrologyDatabase.getDatabase(application)&#10;    private val dao = database.astrologyReadingDao()&#10;&#10;    private val _astrologyJsonData = MutableStateFlow&lt;String?&gt;(null)&#10;    val astrologyJsonData: StateFlow&lt;String?&gt; = _astrologyJsonData.asStateFlow()&#10;&#10;    private val _isLoading = MutableStateFlow(false)&#10;    val isLoading: StateFlow&lt;Boolean&gt; = _isLoading.asStateFlow()&#10;    &#10;    private val _isReady = MutableStateFlow(false)&#10;    val isReady: StateFlow&lt;Boolean&gt; = _isReady.asStateFlow()&#10;    &#10;    private var liveSessionManager: LiveSessionManager? = null&#10;&#10;    fun loadAstrologyData(username: String, context: Context) {&#10;        viewModelScope.launch {&#10;            _isLoading.value = true&#10;            try {&#10;                // Fetch the latest reading for this person&#10;                val readings = dao.getReadingsByUsername(username)&#10;                val jsonData = readings.firstOrNull()?.jsonData&#10;                &#10;                if (jsonData != null) {&#10;                    _astrologyJsonData.value = jsonData&#10;                    &#10;                    // Initialize LiveSessionManager with the JSON data&#10;                    liveSessionManager = LiveSessionManager(context, jsonData)&#10;                    &#10;                    _isReady.value = true&#10;                    println(&quot;Loaded astrology data for: $username&quot;)&#10;                } else {&#10;                    println(&quot;No data found for: $username&quot;)&#10;                }&#10;            } catch (e: Exception) {&#10;                println(&quot;Error loading astrology data: ${e.message}&quot;)&#10;            } finally {&#10;                _isLoading.value = false&#10;            }&#10;        }&#10;    }&#10;    &#10;    fun startListening() {&#10;        viewModelScope.launch {&#10;            liveSessionManager?.startListening(viewModelScope)&#10;        }&#10;    }&#10;    &#10;    fun stopListening() {&#10;        viewModelScope.launch {&#10;            liveSessionManager?.stopListening()&#10;        }&#10;    }&#10;    &#10;    override fun onCleared() {&#10;        super.onCleared()&#10;        viewModelScope.launch {&#10;            liveSessionManager?.stopListening()&#10;        }&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>